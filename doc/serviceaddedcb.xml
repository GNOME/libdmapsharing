<?xml version="1.0"?>
<!DOCTYPE refentry PUBLIC "-//OASIS//DTD DocBook XML V4.3//EN"
               "http://www.oasis-open.org/docbook/xml/4.3/docbookx.dtd" [
]>
<refentry id="serviceaddedcb">
	<refmeta>
		<refentrytitle>Service Added Callback</refentrytitle>
		<manvolnum>3</manvolnum>
		<refmiscinfo>Libdmapsharing</refmiscinfo>
	</refmeta>

	<refnamediv>
		<refname>Service Added Callback</refname>
		<refpurpose>
			Defining a Service Added Callback
		</refpurpose>
	</refnamediv>

	<refsect1>
		<title>Service Added Callback</title>
		<para>
The "service-added" callback typically creates DmapDb and
DmapRecordFactory objects, and then passes these objects to
dmap_connection_new. A subsequent call to the dmap_connection_start
method causes this connection object to interact with the DAAP share in order to
populate the client's DmapDb.
The next section describes the "connected" callback.

		</para>
		<para>
The following is a simple "service-added" callback which creates a DAAP connection:

		</para>
		<screen>
static void
service_added_cb(DmapMdnsBrowser        *browser,
                 DmapMdnsBrowserService *service,
                 gpointer user_data)

	DmapRecordFactory *factory;
	DmapConnection *conn;
	DmapDb *db;

	db = DMAP_DB(my_dmap_db_new());
	if (db == NULL) {
		g_error("Error creating DB");
	}

	factory = DMAP_RECORD_FACTORY(my_dmap_av_record_factory_new());
	if (factory == NULL) {
		g_error("Error creating record factory");
	}
	conn = DMAP_CONNECTION(dmap_av_connection_new(service->name,
	                       service->host,
	                       service->port,
	                       db,
	                       factory));
	dmap_connection_start(conn,
	                     (DmapConnectionFunc) connected_cb,
	                      db);
}
		</screen>
	</refsect1>
</refentry>
